<div class="bar">
  <button id="btnRaw">Télécharger la liste (URLs RAW)</button>
</div>
<script>
const RAW_BASE = 'https://raw.githubusercontent.com/Agdistys/Conversations/main/Reconnaissance/';
fetch('https://api.github.com/repos/Agdistys/Conversations/contents/Reconnaissance',{cache:'no-store'})
  .then(r=>r.json())
  .then(items=>{
    const files = Array.isArray(items) ? items.filter(x=>x.type==='file') : [];
    const rawList = files.map(f => RAW_BASE + encodeURIComponent(f.name)).join('\n');
    document.getElementById('btnRaw').onclick = () => {
      const a=document.createElement('a');
      a.href=URL.createObjectURL(new Blob([rawList],{type:'text/plain;charset=utf-8'}));
      a.download='Reconnaissance-urls-raw.txt'; a.click();
      setTimeout(()=>URL.revokeObjectURL(a.href),1000);
    };
  })
  .catch(e=>console.error(e));
</script>



<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Conversations — Galerie publique</title>
<style>
  body{margin:0;background:#0b0b0c;color:#e8e8ec;font:16px/1.6 system-ui,Segoe UI,Inter,Arial,sans-serif}
  .wrap{max-width:1100px;margin:0 auto;padding:22px}
  h1{font-size:1.6rem;margin:.2rem 0 1rem;color:#F0C45A}
  .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:12px}
  .card{background:#121214;border:1px solid rgba(255,255,255,.1);border-radius:12px;overflow:hidden}
  .card a{color:inherit;text-decoration:none}
  .card img{width:100%;height:160px;object-fit:cover;display:block;background:#000}
  .name{padding:8px 10px;font-size:.9rem;color:#F0C45A}
  .bar{display:flex;gap:8px;flex-wrap:wrap;margin:10px 0 18px}
  button{padding:8px 10px;border-radius:10px;border:1px solid rgba(255,255,255,.16);background:rgba(255,255,255,.04);color:#F0C45A;cursor:pointer}
  button:hover{background:rgba(240,196,90,.14)}
  .hint{color:#bfc4cf;font-size:.9rem;margin:4px 0 16px}
</style>
</head>
<body>
<div class="wrap">
  <h1>Conversations — Reconnaissance</h1>
  <div class="hint">Cette page liste automatiquement les fichiers de <code>Reconnaissance/</code>.</div>
  <div class="bar">
    <button id="btnPages">Télécharger la liste (URLs Pages)</button>
    <button id="btnRaw">Télécharger la liste (URLs RAW)</button>
  </div>
  <div id="grid" class="grid">Chargement…</div>
</div>

<script>
// === CONFIG — adapte seulement ces 3 constantes si nécessaire ===
const OWNER = 'Agdistys';
const REPO  = 'Conversations';
const PATH  = 'Reconnaissance'; // dossier que tu veux lister
// ================================================================

const api = `https://api.github.com/repos/${OWNER}/${REPO}/contents/${PATH}`;
const pageBase = `https://${OWNER.toLowerCase()}.github.io/${REPO}/${PATH}/`;
const rawBase  = `https://raw.githubusercontent.com/${OWNER}/${REPO}/main/${PATH}/`;

function saveText(filename, content){
  const blob = new Blob([content], {type: 'text/plain;charset=utf-8'});
  const url = URL.createObjectURL(blob);
  const a = Object.assign(document.createElement('a'), {href:url, download:filename});
  document.body.appendChild(a); a.click(); a.remove();
  setTimeout(()=>URL.revokeObjectURL(url),1000);
}

function isPreviewable(name){
  return /\.(png|jpe?g|gif|webp|svg|pdf)$/i.test(name);
}

fetch(api, {cache:'no-store'})
  .then(r => r.json())
  .then(items => {
    if(!Array.isArray(items)) throw new Error('API GitHub: réponse inattendue');
    // Garde uniquement les fichiers (pas de sous-dossiers)
    const files = items.filter(x => x.type === 'file');

    // Construire la grille
    const grid = document.getElementById('grid');
    grid.innerHTML = '';
    files.forEach(f => {
      const card = document.createElement('div'); card.className = 'card';
      const isImg = /\.(png|jpe?g|gif|webp|svg)$/i.test(f.name);
      const isPdf = /\.pdf$/i.test(f.name);
      const img = document.createElement(isImg ? 'img' : 'div');
      if(isImg){
        img.src = pageBase + encodeURIComponent(f.name);
        img.alt = f.name; img.loading = 'lazy';
      }else{
        img.style = 'height:160px;display:flex;align-items:center;justify-content:center;background:#000;color:#8892a6;font-size:.9rem';
        img.textContent = isPdf ? 'PDF' : 'Fichier';
      }
      const a = document.createElement('a');
      a.href = pageBase + encodeURIComponent(f.name);
      a.target = '_blank'; a.rel = 'noopener';
      a.appendChild(img);

      const name = document.createElement('div'); name.className = 'name';
      name.textContent = f.name;

      card.appendChild(a);
      card.appendChild(name);
      grid.appendChild(card);
    });

    // Générateurs de listes
    const pagesList = files.map(f => pageBase + encodeURIComponent(f.name)).join('\n');
    const rawList   = files.map(f => rawBase  + encodeURIComponent(f.name)).join('\n');

    document.getElementById('btnPages').onclick = () => saveText(`${PATH}-urls-pages.txt`, pagesList);
    document.getElementById('btnRaw').onclick   = () => saveText(`${PATH}-urls-raw.txt`,   rawList);
  })
  .catch(err => {
    document.getElementById('grid').textContent = 'Erreur de chargement : ' + err.message;
    console.error(err);
  });
</script>
</body>
</html>
